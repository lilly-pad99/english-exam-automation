name: Daily English Exam Generator

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (UTC ê¸°ì¤€ 0ì‹œ, í•œêµ­ì‹œê°„ 9ì‹œ)
    - cron: '0 0 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
    inputs:
      test_mode:
        description: 'Test mode (true/false)'
        required: false
        default: 'false'

jobs:
  generate-and-send-exam:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        npm install
        echo "âœ… Dependencies installed"
        
    - name: ğŸ“Š Check vocabs.xlsx file
      run: |
        if [ -f "data/vocabs.xlsx" ]; then
          echo "âœ… vocabs.xlsx file found"
          ls -la data/vocabs.xlsx
        else
          echo "âŒ vocabs.xlsx file not found"
          echo "Creating data directory..."
          mkdir -p data
          echo "Please upload vocabs.xlsx to data/ directory"
          exit 1
        fi
        
    - name: ğŸ—ï¸ Generate exam files
      run: |
        echo "ğŸ“ Generating exam files..."
        npm run generate-exam
        echo "âœ… Exam files generated"
        
    - name: ğŸ“¤ Send to Slack
      env:
        SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
      run: |
        echo "ğŸ“¤ Sending files to Slack..."
        npm run send-to-slack
        echo "âœ… Files sent to Slack"
        
    - name: ğŸ§¹ Clean up temporary files
      run: |
        echo "ğŸ§¹ Cleaning up temporary files..."
        rm -f exam_*.md
        rm -f answers_*.md
        echo "âœ… Cleanup completed"
        
    - name: ğŸ“‹ Job summary
      run: |
        echo "## ğŸ‰ Daily Exam Generation Completed" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Exam generated successfully" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Files sent to Slack channel" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ“… Date: $(date)" >> $GITHUB_STEP_SUMMARY

  notify-on-failure:
    runs-on: ubuntu-latest
    needs: generate-and-send-exam
    if: failure()
    
    steps:
    - name: ğŸš¨ Notify failure
      uses: actions/github-script@v6
      with:
        script: |
          console.log('âŒ Daily exam generation failed');
          console.log('Please check the workflow logs for details'); 
